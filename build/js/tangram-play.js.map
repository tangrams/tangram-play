{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","src/js/addons/suggestedKeys.js","tangram-play.js","src/js/addons/widgets.js","src/js/core/common.js","src/js/core/editor.js","src/js/core/map.js","src/js/core/ui.js","src/js/main.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length",1,"module","loadKeys","cm","configFile","suggestedKeys","pop","JSON","parse","fetchHTTP","token","addToken","suggestKeys","top","getScrollInfo","suggestedKeysMenu","clear","focus","cursor","getCursor","nline","line","address","getKeyAddress","presentKeys","scene","obj","getAddressSceneContent","Object","keys","suggestedKeysList","options","Array","prototype","push","apply","source","keyFromSource","j","indexOf","splice","addSuggestedKeysList","scrollTo","nLine","position","replace","node","makeSuggestedKeyMenu","addLineWidget","coverGutter","noHScroll","updateWidgets","document","createElement","className","close","appendChild","textContent","CodeMirror","on","editor","btn","text","createTextNode","value","setAttribute",2,"loadWidgets","widgets","tokenOBJ","RegExp","test","getKey","getValue","getKeySceneContent","setWidgetPositions","el","parseInt","getAttribute","chrpos","lineInfo","handle","addWidget","ch","clearWidgets","getElementsByClassName","parentNode","removeChild",3,"url","methood","response","request","XMLHttpRequest","onreadystatechange","readyState","status","responseText","open","send","debounce","func","wait","immediate","timeout","context","this","args","arguments","later","callNow","clearTimeout","setTimeout","parseQuery","qstr","query","split","b","decodeURIComponent","parseFeatureFlags","flags","values","getPosition","dom","y","x","offsetTop","offsetLeft","offsetParent","isNumber","toCSS","str","match","Math","round","val","parseFloat","exec","isMobile","navigator","userAgent","toLowerCase",4,"init","style_file","rulers","color","column","lineStyle","lineNumbers","matchBrackets","mode","keyMap","autoCloseBrackets","extraKeys","Ctrl-Space","Tab","replaceSelection","getOption","join","Alt-F","foldCode","state","foldGutter","rangeFinder","Alt-P","takeScreenshot","Ctrl-0","unfoldAll","Ctrl-1","foldByLevel","Ctrl-2","Ctrl-3","Ctrl-4","Ctrl-5","Ctrl-6","Ctrl-7","Ctrl-8","fold","indent","gutters","showCursorWhenSelecting","theme","lineWrapping","autofocus","indentUnit","console","log","changeObj","isSaved","changes","updateContent","from","to","updateKeys","loadStyle","contents","setValue","getLineInd","getSpaces","jumpToLine","charCoords","selectLines","rangeString","lines","foldAllBut","setSelection","isFolder","gutterMarkers","From","To","queryLevel","minLevel","startOn","onBlock","level","chars","opts","lineCount","actualLine","getDoc","size","Utils","SuggestedKeys","createObjectURL","window","URL","webkitURL","content","pattern","result","Blob","reload","../addons/suggestedKeys.js","./common.js",5,"map_start_location","url_hash","location","hash","slice","map","Number","L","zoomControl","keyboardZoomOffset","control","zoom","addTo","attributionControl","setPrefix","layer","Tangram","leafletLayer","postUpdate","attribution","setView","Hash","addEventListener","self","scrollWheelZoom","disable","take_screenshot","image","canvas","toDataURL","data","atob","buf","Uint8Array","charCodeAt","blob","type","saveAs","Date",6,"tangram","transformStyle","getDividerStartingPosition","dividerEl","getElementById","style","hasOwnProperty","transform","webkitTransform","draggable","Draggable","create","bounds","getDraggableBounds","onDrag","reflowUI","Widgets","onDragEnd","updateUI","saveDividerPosition","loadExamples","onWindowResize","menuEl","posX","getBoundingClientRect","left","display","onClickNewButton","body","target","classList","contains","loseMenuFocus","onClickOpenFile","onClickOpenExample","hideExamplesModal","onClickOpenExampleFromDialog","keyCode","setupFileSelector","preventDefault","dataTransfer","dropEffect","showFileDropArea","hideFileDropArea","onDropFile","onpopstate","loadStyleURL","loadFromQueryString","fileSelector","id","onFileSelectorChange","storedPosition","localStorage","getItem","LOCAL_STORAGE_PREFIX","floor","innerWidth","setItem","event","handleContinue","newContent","handleCancel","isEditorSaved","showUnsavedModal","href","examples_data","examplesList","example","newOption","nameEl","name","thumbnailEl","backgroundColor","backgroundImage","selectExample","resetExamples","add","disabled","all","querySelectorAll","remove","openExample","history","pushState","search","files","openContent","reader","FileReader","onload","readAsText","applyNewDraggableBounds","mapEl","contentEl","menuBottom","bottom","positionX","width","setSize","innerHeight","height","invalidateSize","applyBounds","minX","maxX","CM_MINIMUM_WIDTH","showShield","hideShield","confirmCallback","cancelCallback","handleConfirm","hideUnsavedModal","modalEl","querySelector","removeEventListener","hideMenus","els","input","click","showExamplesModal","selected","file","../addons/widgets.js",7,"Map","Editor","UI","createWidgets","./addons/suggestedKeys.js","./addons/widgets.js","./core/common.js","./core/editor.js","./core/map.js","./core/ui.js"],"mappings":"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","file":"tangram-play.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","'use strict';\n\nmodule.exports = {\n    loadKeys,\n    suggestKeys\n}\n\nfunction loadKeys(cm, configFile) {\n\n    // Initialize array\n    if (cm.suggestedKeys) {\n        // Clean key list\n        while (cm.suggestedKeys.length > 0) {\n            cm.suggestedKeys.pop();\n        }\n    } else {\n        cm.suggestedKeys = [];\n    }\n\n    // Load Json\n    cm.suggestedKeys = JSON.parse(fetchHTTP(configFile))[\"keys\"];\n\n    //  Initialize tokens\n    for (var i = 0; i < cm.suggestedKeys.length; i++) {\n        cm.suggestedKeys[i].token = addToken(cm.suggestedKeys[i]);\n    }\n}\n\n//  TODO:\n//          -- Replace global scene by a local\n//\nfunction suggestKeys(cm) {\n    var top = cm.getScrollInfo().top;\n\n    // Erase previus keys\n    if (cm.suggestedKeysMenu) {\n        cm.suggestedKeysMenu.clear();\n        cm.focus();\n    }\n\n    // Get line address\n    cursor = cm.getCursor(true);\n    var nline = cursor.line;\n    var address = getKeyAddress(cm,nline);\n\n    var presentKeys = [];\n\n    if (scene) {\n        var obj = getAddressSceneContent(scene,address);\n        presentKeys = obj? Object.keys(obj) : [];\n    }\n\n    // Search for matches\n    for (var i = 0; i < cm.suggestedKeys.length; i++) {\n        if (cm.suggestedKeys[i].token(scene,cm,nline)) {\n\n            var suggestedKeysList = [];\n\n            if (cm.suggestedKeys[i].options) {\n                Array.prototype.push.apply(suggestedKeysList, cm.suggestedKeys[i].options);\n            }\n\n            if (cm.suggestedKeys[i].source) {\n                var obj = getAddressSceneContent(scene, cm.suggestedKeys[i].source);\n                var keyFromSource = obj? Object.keys(obj) : [];\n                Array.prototype.push.apply(suggestedKeysList, keyFromSource);\n            }\n\n\n            for (var j = suggestedKeysList.length-1; j >= 0; j--) {\n                if (presentKeys.indexOf(suggestedKeysList[j]) > -1) {\n                    suggestedKeysList.splice(j, 1);\n                }\n            }\n\n            if (suggestedKeysList.length > 0) {\n                addSuggestedKeysList(suggestedKeysList,cm,nline);\n            }\n            break;\n        }\n    }\n\n    cm.focus();\n    cm.scrollTo(null,top);\n}\n\nfunction addSuggestedKeysList( suggestedKeysList, cm, nLine ) {\n    var options = {\n        position: \"top\"\n    }\n\n    if (cm.suggestedKeysMenu) {\n        cm.suggestedKeysMenu.clear();\n        options.replace = cm.suggestedKeysMenu;\n    }\n\n    var node = makeSuggestedKeyMenu(suggestedKeysList, nLine);\n    // cm.suggestedKeysMenu = cm.addPanel(node, options);\n    cm.suggestedKeysMenu = cm.addLineWidget(nLine, node, {coverGutter: false, noHScroll: true});\n    updateWidgets(cm);\n}\n\nfunction makeSuggestedKeyMenu(suggestedKeysList, nLine) {\n    var node = document.createElement(\"div\");\n    node.className = \"cm-suggested-keys-menu\";\n\n    var widget, label;\n\n    var close = node.appendChild(document.createElement(\"a\"));\n    close.className =  \"cm-suggested-keys-menu-remove\";\n    close.textContent = \"âœ–\";\n\n    CodeMirror.on(close, \"click\", function() {\n        editor.suggestedKeysMenu.clear();\n    });\n\n    for (var i = 0; i < suggestedKeysList.length; i++) {\n        var btn = document.createElement('button');\n        var text = document.createTextNode(suggestedKeysList[i]);\n        btn.value = nLine;\n        btn.className = 'cm-suggested-keys-menu-btn';\n        btn.setAttribute('onclick', 'addKey(this)');\n        btn.appendChild(text);\n        node.appendChild(btn);\n    }\n\n    return node;\n}\n\n//  TODO:\n//          -- Replace global editor by local\n//\nfunction addKey(div) {\n    editor.suggestedKeysMenu.clear();\n\n    var tabs = getLineInd( editor, parseInt(div.value) )+1;\n    var text = '\\n';\n    for (var i = 0; i < tabs; i++) {\n        text += Array(editor.getOption(\"indentUnit\") + 1).join(\" \");\n    }\n    text += div.innerText+\": \";\n\n    var doc = editor.getDoc();\n    var cursor = doc.getCursor();           // gets the line number in the cursor position\n    var line = doc.getLine(cursor.line);    // get the line contents\n    var pos = {                             // create a new object to avoid mutation of the original selection\n        line: cursor.line,\n        ch: line.length                     // set the character position to the end of the line\n    }\n    doc.replaceRange(text, pos);            // adds a new line\n\n    updateWidgets(editor);\n}\n",null,"'use strict';\n\nmodule.exports = {\n    loadWidgets,\n    updateWidgets\n}\n\nfunction loadWidgets(cm, configFile ){\n\n    // Initialize array\n    if (cm.widgets){\n        // Clean widgets list\n        while(cm.widgets.length > 0) {\n            cm.widgets.pop();\n        }\n    } else {\n        cm.widgets = [];\n    }\n\n    // Load JSON\n    cm.widgets = JSON.parse(fetchHTTP(configFile))[\"widgets\"];\n\n    // Initialize tokens\n    for (var i = 0; i < cm.widgets.length; i++){\n        cm.widgets[i].token = addToken(cm.widgets[i]);\n    }\n}\n\n//  TODO:\n//          -- Replace global scene by a local\n//\nfunction addToken( tokenOBJ ){\n    var token;\n    if ( tokenOBJ['address'] ){\n        token = function(scene, cm, nLine) {\n            return RegExp( tokenOBJ['address'] ).test( getKeyAddress(cm, nLine) );\n        };\n    } else if ( tokenOBJ['key'] ){\n        token = function(scene, cm, nLine) {\n            return RegExp( tokenOBJ['key'] ).test( getKey(cm, nLine) );\n        };\n    } else if ( tokenOBJ['value'] ){\n        token = function(scene, cm, nLine) {\n            return RegExp( tokenOBJ['value'] ).test( getValue(cm, nLine) );\n        };\n    } else if ( tokenOBJ['content'] ){\n        token = function(scene, cm, nLine) {\n            return RegExp( tokenOBJ['content'] ).test( getKeySceneContent(scene, cm, nLine) );\n        };\n    } else {\n        token = function(scene, cm, nLine) {\n            return false;\n        };\n    }\n    return token;\n}\n\n/* TODO: don't global */\nvar widgets = [];\n\nfunction createWidgets (cm) {\n    for (var nline = 0, size = cm.doc.size; nline < size; nline++) {\n        var val = getValue(cm, nline);\n        console.log(val);\n\n        // If Line is significative\n        if (getTag(cm, nline) !== \"\" && val !== \"|\" && val !== \"\" ) {\n\n            // Check for widgets to add\n            for (var i = 0; i < cm.widgets.length; i++) {\n                var proto = cm.widgets[i];\n\n                if (proto.token(scene, cm, nline)) {\n                    var content = getValue(cm, nline);\n                    var el;\n\n                    switch(proto.type) {\n                        case 'colorpicker':\n                            el = createColorpickerWidget(proto, content, nline);\n                            break;\n                        case 'togglebutton':\n                            el = createToggleWidget(proto, content, nline);\n                            break;\n                        case 'dropdownmenu':\n                            el = createDropdownWidget(proto, content, nline);\n                            break;\n                        case 'dropdownmenu-dynamic':\n                            el = createDropdownDynamicWidget(proto, content, nline);\n                            break;\n                        default:\n                            // Nothing\n                            break;\n                    }\n\n                    el.setAttribute('data-nline', nline); /* TODO: change */\n                    widgets.push(el);\n                }\n            }\n        }\n    }\n\n    setWidgetPositions(cm);\n}\n\nfunction createColorpickerWidget (proto, content, nline) {\n    var el = document.createElement('div');\n    el.className = 'widget widget-colorpicker';\n    el.value = nline;\n    el.style.background = toCSS(content);\n    el.setAttribute('onclick', 'colorPickerClicked(this)');\n    return el;\n}\n\nfunction createToggleWidget (proto, content, nline) {\n    var el = document.createElement('input');\n    el.type = 'checkbox';\n    el.className = 'widget widget-toggle';\n    el.checked = (content === 'true') ? true : false;\n    el.value = nline;\n    el.setAttribute('onchange', 'toggleButton(this)');\n    return el;\n}\n\nfunction createDropdownWidget (proto, content, nline) {\n    var el = document.createElement('select');\n    el.className = 'widget widget-dropdown';\n\n    for (var i = 0; i < proto.options.length; i++ ) {\n        var newOption = document.createElement('option');\n        newOption.value = nline;\n        if (content === proto.options[i]) {\n            newOption.selected = true;\n        }\n        newOption.innerHTML = proto.options[i];\n        el.appendChild(newOption);\n    }\n\n    el.setAttribute('onchange', 'dropdownMenuChange(this)');\n    return el;\n}\n\nfunction createDropdownDynamicWidget (proto, content, nline) {\n    var el = document.createElement('select');\n    var obj = getAddressSceneContent(scene, proto.source);\n    var keys = (obj) ? Object.keys(obj) : {};\n\n    el.className = 'widget widget-dropdown-dynamic';\n\n    if (proto.options) {\n        for (var i = 0; i < proto.options.length; i++) {\n            var newOption = document.createElement('option');\n            newOption.value = nline;\n            if (content === proto.options[i]) {\n                newOption.selected = true;\n            }\n            newOption.innerHTML= proto.options[i];\n            el.appendChild(newOption);\n        }\n    }\n\n    for (var j = 0; j < keys.length; j++) {\n        var newOption = document.createElement('option');\n        newOption.value = nline;\n        if (content === keys[j]) {\n            newOption.selected = true;\n        }\n        newOption.innerHTML= keys[j];\n        el.appendChild(newOption);\n    }\n\n    el.setAttribute('onchange', 'dropdownMenuChange(this)');\n    return el;\n}\n\nfunction setWidgetPositions (cm) {\n    for (var i = 0, j = widgets.length; i < j; i++) {\n        var el = widgets[i];\n        var nline = parseInt(el.getAttribute('data-nline'), 10);\n        var chrpos = cm.lineInfo(nline).handle.text.length;\n        cm.addWidget({ line: nline, ch: chrpos }, el);\n    }\n}\n\nfunction clearWidgets () {\n    var widgets = document.getElementsByClassName('widget');\n    while (widgets[0]) {\n        widgets[0].parentNode.removeChild(widgets[0]);\n    }\n}\n\nfunction clearWidget (widgetId) {\n\n}\n\nfunction updateWidgets (cm) {\n    clearWidgets();\n    setWidgetPositions(cm);\n}\n\n/**\n * @param {array} changes - An array of changes in a batch operation from CodeMirror.\n */\nfunction updateWidgetsOnEditorChanges (changes) {\n    // Given changed lines in CodeMirror\n    // We need to rebuild some widgets because data may have changed in them.\n    console.log(changes);\n    // TODO.\n}\n\n//  TODO:\n//          -- Replace global editor by local\n//\nfunction colorPickerClicked(div){\n    var picker = new thistle.Picker(div.style.background);\n\n    var pos = getPosition(div);\n    picker.presentModal(pos.x+20,\n                        editor.heightAtLine(parseInt(div.value))+20);\n\n    picker.on('changed', function() {\n        div.style.background = picker.getCSS();\n        var color = picker.getRGB();\n        var str = \"[\"+ color.r.toFixed(3) + \",\" + color.g.toFixed(3) + \",\" + color.b.toFixed(3) + \"]\";\n        setValue( editor, parseInt(div.value), str );\n    });\n}\n\nfunction dropdownMenuChange(select) {\n    setValue(   editor,\n                parseInt(select.options[select.selectedIndex].value),\n                select.options[select.selectedIndex].innerHTML );\n}\n\nfunction toggleButton(check) {\n    setValue(   editor,\n                parseInt(check.value),\n                check.checked?\"true\":\"false\" );\n}\n","'use strict';\n\nmodule.exports = {\n    debounce,\n    fetchHTTP,\n    getPosition,\n    isMobile,\n    isNumber,\n    parseFeatureFlags,\n    parseQuery,\n    toCSS\n};\n\nfunction fetchHTTP(url, methood) {\n    var request = new XMLHttpRequest(), response;\n\n    request.onreadystatechange = function () {\n        if (request.readyState === 4 && request.status === 200) {\n            response = request.responseText;\n        }\n    }\n    request.open(methood ? methood : 'GET', url, false);\n    request.send();\n    return response;\n};\n\nfunction debounce(func, wait, immediate) {\n    var timeout;\n    return function() {\n        var context = this, args = arguments;\n        var later = function() {\n            timeout = null;\n            if (!immediate) func.apply(context, args);\n        };\n        var callNow = immediate && !timeout;\n        clearTimeout(timeout);\n        timeout = setTimeout(later, wait);\n        if (callNow) func.apply(context, args);\n    };\n};\n\nfunction parseQuery(qstr) {\n    var query = {};\n    var a = qstr.split('&');\n    for (var i in a) {\n        var b = a[i].split('=');\n        query[decodeURIComponent(b[0])] = decodeURIComponent(b[1]);\n    }\n    return query;\n};\n\nfunction parseFeatureFlags(query) {\n    var qstr = query['flags'];\n    var flags = {};\n    if (!qstr) return flags;\n    var values = qstr.split(',');\n    for (var i in values) {\n        flags[values[i]] = true;\n    }\n    return flags;\n};\n\nfunction getPosition(dom) {\n    var y = 0, x = 0;\n    do {\n        y += dom.offsetTop  || 0;\n        x += dom.offsetLeft || 0;\n        dom = dom.offsetParent;\n    } while (dom);\n\n    return {\n        y: y,\n        x: x\n    };\n};\n\n//  Check if a variable is a number\nfunction isNumber(n) { return /^-?[\\d.]+(?:e-?\\d+)?$/.test(n);};\n\nfunction toCSS(str) {\n    var match = str.match(/\\[\\s*(\\d\\.|\\d*\\.?\\d+)\\s*,\\s*(\\d\\.|\\d*\\.?\\d+)\\s*,\\s*(\\d\\.|\\d*\\.?\\d+)\\s*\\]/);\n    if (match) {\n        str = 'rgb(' + Math.round(match[1]*255)+\",\"+\n                        Math.round(match[2]*255)+\",\"+\n                        Math.round(match[3]*255)+\")\";\n    } else if (isNumber(str)) {\n        var val = Math.round( parseFloat(str)*255 );\n        str = 'rgb('+val+\",\"+val+\",\"+val+\")\";\n    } else if (/^\\s*[\\'|\\\"]#[0-9a-f]{3}(?:[0-9a-f]{3})?[\\'|\\\"]\\s*$/i.test(str)) {\n        var value = /[\\'|\\\"]([\\w|\\W|\\s]+)[\\'|\\\"]/gm.exec(str);\n        return value ? value[1] : \"\";\n\n    }\n\n    return str;\n};\n\nfunction isMobile () {\n  if (/iphone|ipod|android|blackberry|opera|mini|windows\\sce|palm|smartphone|iemobile/i.test(navigator.userAgent.toLowerCase()))\n    return true;\n  else\n    return false;\n};\n","//  TODO:\n//       - Replace global scene by a local\n//\n'use strict';\n\nconst Utils = require('./common.js');\nconst SuggestedKeys = require('../addons/suggestedKeys.js');\n\n//const YAMLTangram = require('../parsers/yaml-tangram.js');\n\n//const CodeMirror = require('codemirror');\n\n// Temp remap all utility functions to local vars\nconst debounce = Utils.debounce;\nconst fetchHTTP = Utils.fetchHTTP;\nconst suggestKeys = SuggestedKeys.suggestKeys;\n\n//  Main CM functions\n//  ===============================================================================\nvar updateContent = debounce(function(cm) {\n    var createObjectURL = (window.URL && window.URL.createObjectURL) || (window.webkitURL && window.webkitURL.createObjectURL); // for Safari compatibliity\n\n    //  If doesn't have a API key\n    //  inject a Tangram-Play one: vector-tiles-x4i7gmA ( Patricio is the owner )\n    var content = cm.getValue();\n    var pattern = /(^\\s+url:\\s+([a-z]|[A-Z]|[0-9]|\\/|\\{|\\}|\\.|\\:)+mapzen.com([a-z]|[A-Z]|[0-9]|\\/|\\{|\\}|\\.|\\:)+(topojson|geojson|mvt)$)/gm;\n    var result = \"$1??api_key=vector-tiles-x4i7gmA\"\n    content = content.replace(pattern, result);\n\n    if (scene) {\n        var url = createObjectURL(new Blob([content]));\n        scene.reload(url);\n        updateWidgets(cm);\n    }\n}, 500);\n\nvar updateKeys = debounce(function(cm) {\n    suggestKeys(cm);\n}, 1000);\n\n\nmodule.exports = {\n    init,\n    updateContent,\n    updateKeys,\n    unfoldAll,\n    foldByLevel,\n    selectLines\n}\n\n//  Initialize the editor in a specific DOM and with the context of a style_file\n//\nfunction init (dom, style_file) {\n\n    var rulers = [];\n    for (var i = 1; i < 10; i++) {\n        var b = Math.round((0.88 + i/90)*255);\n        rulers.push({   color: 'rgb('+b+','+b+','+b+')',\n                        column: i * 4,\n                        lineStyle: \"dashed\"     });\n    }\n\n    var cm = CodeMirror(dom ,{\n        value: \"Loading...\",\n        rulers: rulers,\n        lineNumbers: true,\n        matchBrackets: true,\n        mode: \"text/x-yaml-tangram\",\n        keyMap: \"sublime\",\n        autoCloseBrackets: true,\n        extraKeys: {\"Ctrl-Space\": \"autocomplete\",\n                    \"Tab\": function(cm) { cm.replaceSelection(Array(cm.getOption(\"indentUnit\") + 1).join(\" \")); },\n                    \"Alt-F\" : function(cm) { cm.foldCode(cm.getCursor(), cm.state.foldGutter.options.rangeFinder); } ,\n                    \"Alt-P\" : function(cm) {takeScreenshot();},\n                    \"Ctrl-0\" : function(cm) {unfoldAll(cm)},\n                    \"Ctrl-1\" : function(cm) {foldByLevel(cm,0)},\n                    \"Ctrl-2\" : function(cm) {foldByLevel(cm,1)},\n                    \"Ctrl-3\" : function(cm) {foldByLevel(cm,2)},\n                    \"Ctrl-4\" : function(cm) {foldByLevel(cm,3)},\n                    \"Ctrl-5\" : function(cm) {foldByLevel(cm,4)},\n                    \"Ctrl-6\" : function(cm) {foldByLevel(cm,5)},\n                    \"Ctrl-7\" : function(cm) {foldByLevel(cm,6)},\n                    \"Ctrl-8\" : function(cm) {foldByLevel(cm,7)}\n        },\n        foldGutter: {\n            rangeFinder: CodeMirror.fold.indent\n        },\n        gutters: [\"CodeMirror-linenumbers\", \"CodeMirror-foldgutter\"],\n        showCursorWhenSelecting: true,\n        theme: \"tangram\",\n        lineWrapping: true,\n        autofocus: true,\n        indentUnit: 4\n    });\n\nconsole.log(cm)\n\n    //  Hook events\n\n    //  Update Tangram Map when stop typing\n    cm.on('change', function (cm, changeObj) {\n        if (cm.isSaved) {\n            cm.isSaved = false;\n        }\n    });\n\n    // Update widgets & content after a batch of changes\n    cm.on('changes', function (cm, changes) {\n        updateWidgets(cm);\n        //updateWidgetsOnEditorChanges(changes);\n        updateContent(cm);\n    });\n\n    //  When the viewport change (lines are add or erased)\n    cm.on(\"viewportChange\", function(cm, from, to) {\n        updateWidgets(cm);\n    });\n\n    // cm.on(\"mousedown\", function(event) {\n    //     // var cursor = editor.getCursor(true);\n    // });\n\n    cm.on(\"cursorActivity\", function(cm) {\n        updateKeys(cm);\n    });\n\n    loadStyle(cm, fetchHTTP(style_file));\n\n    return cm;\n};\n\n//  Common IO functions to CM\n//  ===============================================================================\nfunction loadStyle(cm, contents) {\n    if (contents) {\n\n        contents = contents.replace(/\\?api_key\\=(\\w|\\-)*$/gm,\"\");\n\n        //  Delete API Key\n        cm.setValue(contents);\n        cm.isSaved = true;\n\n        // TODO:\n        //      - instead of deleting the key if should check if\n        //      this user owns the key. If it doesn't delete it\n\n    }\n}\n\nfunction getContent(cm) {\n    return cm.getValue();\n}\n\n//  Common CM functions\n//  ===============================================================================\n\n//  Get the indentation level of a line\nfunction getInd(string) { return getSpaces(string) / 4;};\nfunction getLineInd(cm, nLine) { return getSpaces(cm.lineInfo(nLine).text) / cm.getOption(\"tabSize\"); };\n\n//  Check if a line is empty\nfunction isStrEmpty(str) { return (!str || 0 === str.length || /^\\s*$/.test(str)); };\nfunction isEmpty(cm, nLine) { return isStrEmpty(cm.lineInfo(nLine).text); };\n\n//  Check if the line is commented YAML style\nfunction isStrCommented(str) { var regex = /^\\s*[\\#||\\/\\/]/gm; return (regex.exec(str) || []).length > 0; };\nfunction isCommented(cm, nLine) { return isStrCommented(cm.lineInfo(nLine).text); };\n\n//  Common NAVIGATION functions on CM\n//  ===============================================================================\n\n//  Jump to a specific line\nfunction jumpToLine(cm, nLine) { cm.scrollTo( null, cm.charCoords({line: nLine-1, ch: 0}, \"local\").top ); };\n\n//  Jump to a specific line\nfunction jumpToLineAt(cm, nLine, offset) {\n    var t = cm.charCoords({line: nLine-1, ch: 0}, \"local\").top;\n    cm.scrollTo(null, t);\n};\n\n//  Common SELECTION function on CM\n//  ===============================================================================\n\n//  Select a line or a range of lines\n//\nfunction selectLines(cm, rangeString) {\n    var from, to;\n\n    if (isNumber(rangeString)) {\n        from = parseInt(rangeString)-1;\n        to = from;\n    } else {\n        var lines = rangeString.split('-');\n        from = parseInt(lines[0])-1;\n        to = parseInt(lines[1])-1;\n    }\n\n    // If folding level is on un fold the lines selected\n    if (query['foldLevel']) {\n        foldAllBut(cm, from,to,query['foldLevel']);\n    }\n\n    cm.setSelection({ line: from, ch:0},\n                    { line: to, ch:cm.lineInfo(to).text.length } );\n    jumpToLine(cm,from);\n};\n\n//  Common FOLD functions on CM\n//  ===============================================================================\n\n//  Is posible to fold\n//\nfunction isFolder(cm, nLine) {\n    if ( cm.lineInfo(nLine).gutterMarkers ) {\n        return cm.lineInfo(nLine).gutterMarkers['CodeMirror-foldgutter'] !== null;\n    } else {\n        return false;\n    }\n};\n\n//  Select everything except for a range of lines\n//\nfunction foldAllBut(cm, From, To, queryLevel) {\n    // default level is 0\n    queryLevel = typeof queryLevel !== 'undefined' ? queryLevel : 0;\n\n    // fold everything\n    foldByLevel(cm, queryLevel);\n\n    // get minimum indentation\n    var minLevel = 10;\n    var startOn = To;\n    var onBlock = true;\n\n    for (var i = From-1; i >= 0; i--) {\n\n        var level = getLineInd(cm, i);\n\n        if (level === 0) {\n            break;\n        }\n\n        if (level < minLevel) {\n            minLevel = level;\n        } else if (onBlock) {\n            startOn = i;\n            onBlock = false;\n        }\n    }\n\n    minLevel = 10;\n    for (var i = To; i >= From; i--) {\n        var level = getLineInd(cm, i);\n        var chars = cm.lineInfo(i).text.length;\n        if (level < minLevel && chars > 0) {\n            minLevel = level;\n        }\n    }\n    var opts = cm.state.foldGutter.options;\n\n    for (var i = startOn; i >= 0; i--) {\n        var level = getLineInd(cm, i);\n\n        if (level === 0 && cm.lineInfo(i).text.length > 0) {\n            break;\n        }\n\n        if (level <= minLevel) {\n            cm.foldCode({ line: i }, opts.rangeFinder, \"fold\");\n        }\n    }\n\n    for (var i = To; i < cm.lineCount() ; i++) {\n        if (getLineInd(cm, i) >= queryLevel) {\n            cm.foldCode({ line: i }, opts.rangeFinder, \"fold\");\n        }\n    }\n};\n\n//  Unfold all lines\n//\nfunction unfoldAll(cm) {\n    var opts = cm.state.foldGutter.options;\n    for (var i = 0; i < cm.lineCount() ; i++) {\n        cm.foldCode({ line: i }, opts.rangeFinder, \"unfold\");\n    }\n};\n\n//  Fold all lines above a specific indentation level\n//\nfunction foldByLevel(cm, level) {\n    unfoldAll(cm);\n    var opts = cm.state.foldGutter.options;\n\n    var actualLine = cm.getDoc().size-1;\n    while (actualLine >= 0) {\n        if (isFolder(cm, actualLine)) {\n            if (getLineInd(cm, actualLine) >= level) {\n                cm.foldCode({line:actualLine,ch:0}, opts.rangeFinder);\n            }\n        }\n        actualLine--;\n    }\n};\n","'use strict';\n\nvar take_screenshot = false;\n\nmodule.exports = {\n    init,\n    postUpdate\n}\n\nfunction init (style_file) {\n    var map_start_location = [0.0, 0.0, 3];\n\n    /*** URL parsing ***/\n\n    // leaflet-style URL hash pattern:\n    // ?style.yaml#[zoom],[lat],[lng]\n    var url_hash = window.location.hash.slice(1).split('/');\n    if (url_hash.length == 3) {\n        map_start_location = [url_hash[1],url_hash[2], url_hash[0]];\n        // convert from strings\n        map_start_location = map_start_location.map(Number);\n    }\n\n    /*** Map ***/\n    var map = L.map('map',\n        { zoomControl: false },\n        {'keyboardZoomOffset': .05}\n    );\n\n    L.control.zoom({position: 'topright'}).addTo(map);\n\n    map.attributionControl.setPrefix('<a href=\"http://leafletjs.com\" title=\"A JS library for interactive maps\" target=\"_blank\">Leaflet</a>')\n    var layer = Tangram.leafletLayer({\n        scene: style_file,\n        postUpdate: postUpdate,\n        attribution: '<a href=\"https://mapzen.com/tangram\" target=\"_blank\">Tangram</a> | &copy; OSM contributors | <a href=\"https://mapzen.com/\" target=\"_blank\">Mapzen</a>'\n    });\n\n    window.layer = layer;\n    var scene = layer.scene;\n    window.scene = scene;\n\n    map.setView(map_start_location.slice(0, 2), map_start_location[2]);\n    var hash = new L.Hash(map);\n\n    window.addEventListener('load', function () {\n        // Scene initialized\n        layer.addTo(map);\n    });\n\n    //disable mousewheel zoom if iframed\n    if (window.self !== window.top) {\n        map.scrollWheelZoom.disable();\n    }\n\n    return map;\n}\n\nfunction postUpdate() {\n    if (take_screenshot == true) {\n        // Adapted from: https://gist.github.com/unconed/4370822\n        var image = scene.canvas.toDataURL('image/png').slice(22); // slice strips host/mimetype/etc.\n        var data = atob(image); // convert base64 to binary without UTF-8 mangling\n        var buf = new Uint8Array(data.length);\n        for (var i = 0; i < data.length; ++i) {\n            buf[i] = data.charCodeAt(i);\n        }\n        var blob = new Blob([buf], { type: 'image/png' });\n        saveAs(blob, 'tangram-' + (+new Date()) + '.png'); // uses FileSaver.js: https://github.com/eligrey/FileSaver.js/\n\n        take_screenshot = false;\n    }\n}\n","'use strict';\n\nvar Widgets = require('../addons/widgets.js');\n\nvar CM_MINIMUM_WIDTH = 160 // integer, in pixels\nvar LOCAL_STORAGE_PREFIX = 'tangram-play-'\n\nvar draggable;\n\nmodule.exports = {\n    init\n}\n\nfunction init (cm, tangram) {\n    var transformStyle = 'translate3d(' + getDividerStartingPosition() + 'px, 0px, 0px)';\n    var dividerEl = document.getElementById('divider');\n    console.log('dividerEl')\n    if (dividerEl.style.hasOwnProperty('transform')) {\n        dividerEl.style.transform = transformStyle;\n    } else if (dividerEl.style.hasOwnProperty('webkitTransform')) {\n        // For Safari\n        dividerEl.style.webkitTransform = transformStyle;\n    } else {\n        // For Firefox\n        dividerEl.style.transform = transformStyle;\n    }\n\n    var count = 0;\n    draggable = Draggable.create(\"#divider\", {\n        type: \"x\",\n        bounds: getDraggableBounds(),\n        cursor: 'col-resize',\n        onDrag: function () {\n            reflowUI();\n            Widgets.updateWidgets(cm);\n            //setWidgetPositions(cm);\n        },\n        onDragEnd: function () {\n            updateUI(cm, tangram);\n            saveDividerPosition();\n        }\n    });\n\n    loadExamples(\"data/examples.json\");\n    window.addEventListener('resize', onWindowResize);\n    reflowUI();\n\n    document.getElementById('menu-button-open').addEventListener('click', function (e) {\n        var menuEl = document.getElementById('menu-open')\n        var posX = document.getElementById('menu-button-open').getBoundingClientRect().left\n        menuEl.style.left = posX + 'px'\n        menuEl.style.display = (menuEl.style.display === 'block') ? 'none' : 'block'\n    }, false)\n\n    document.getElementById('menu-button-new').addEventListener('click', onClickNewButton, false)\n    document.body.addEventListener('click', function (e) {\n        if (!e.target.classList.contains('menu-item') && !e.target.parentNode.classList.contains('menu-item') ) {\n            loseMenuFocus()\n        }\n    }, false)\n    document.getElementById('menu-open-file').addEventListener('click', onClickOpenFile, false)\n    document.getElementById('menu-open-example').addEventListener('click', onClickOpenExample, false)\n    document.getElementById('example-cancel').addEventListener('click', hideExamplesModal, false)\n    document.getElementById('example-confirm').addEventListener('click', onClickOpenExampleFromDialog, false)\n    document.body.addEventListener('keyup', function (e) {\n        // esc key\n        if (e.keyCode === 27) {\n            // TODO. Implement after UI elements handle / remember state better\n        }\n    })\n    setupFileSelector();\n\n    // Set up drag/drop file listeners\n    document.body.addEventListener('dragenter', function (e) {\n        e.preventDefault();\n        e.dataTransfer.dropEffect = 'copy';\n        showFileDropArea();\n    }, true)\n    document.getElementById('file-drop').addEventListener('dragover', function (e) {\n        e.preventDefault();\n        showFileDropArea();\n    }, false)\n    document.getElementById('file-drop').addEventListener('dragleave', function (e) {\n        e.preventDefault();\n        hideFileDropArea();\n    }, true)\n    document.getElementById('file-drop').addEventListener('drop', onDropFile, false)\n\n    window.onpopstate = function (e) {\n        if (e.state && e.state.loadStyleURL) {\n            loadFromQueryString();\n        }\n    }\n};\n\nfunction setupFileSelector () {\n    var fileSelector = document.createElement('input');\n    fileSelector.setAttribute('type', 'file');\n    fileSelector.setAttribute('accept', 'text/x-yaml');\n    fileSelector.style.display = 'none';\n    fileSelector.id = 'file-selector';\n    fileSelector.addEventListener('change', onFileSelectorChange);\n    document.body.appendChild(fileSelector);\n}\n\nfunction getDividerStartingPosition () {\n    var storedPosition = window.localStorage.getItem(LOCAL_STORAGE_PREFIX + 'divider-position-x')\n    if (storedPosition) {\n        return storedPosition\n    }\n\n    if (window.innerWidth > 1024) {\n        return Math.floor(window.innerWidth * 0.6)\n    } else {\n        return Math.floor(window.innerWidth / 2)\n    }\n}\n\nfunction saveDividerPosition () {\n    var posX = document.getElementById('divider').getBoundingClientRect().left\n    if (posX) {\n        window.localStorage.setItem(LOCAL_STORAGE_PREFIX + 'divider-position-x', posX)\n    }\n}\n\nfunction onClickNewButton (event) {\n    if (isEditorSaved() === false) {\n        showUnsavedModal(handleContinue, handleCancel)\n    } else {\n        handleContinue()\n    }\n\n    function handleContinue () {\n        newContent();\n    }\n\n    function handleCancel () {\n        return;\n    }\n}\n\nfunction newContent () {\n    window.location.href = \".\";\n}\n\nfunction loadExamples (configFile) {\n    var examples_data = JSON.parse(fetchHTTP(configFile));\n    var examplesList = document.getElementById(\"examples\");\n\n    for (var i = 0; i < examples_data['examples'].length; i++) {\n        var example = examples_data['examples'][i];\n        var newOption = document.createElement('div');\n        var nameEl = document.createElement('div');\n        var name = example['name'].split('.')[0];\n        var thumbnailEl = document.createElement('div');\n        //var imgEl = document.createElement('img');\n        newOption.className = 'example-option';\n        newOption.setAttribute('data-value', example['url']);\n        nameEl.className = 'example-option-name';\n        nameEl.textContent = name.replace(/-/g, ' ');\n        //imgEl.src = 'data/imgs/' + name + '.png';\n        thumbnailEl.className = 'example-thumbnail';\n        thumbnailEl.style.backgroundColor = 'rgba(255,255,255,0.05)';\n        thumbnailEl.style.backgroundImage = 'url(https://cdn.rawgit.com/tangrams/tangram-sandbox/gh-pages/styles/' + name + '.png)';\n        newOption.appendChild(nameEl);\n        newOption.appendChild(thumbnailEl);\n        //newOption.appendChild(imgEl);\n        newOption.addEventListener('click', selectExample);\n        examplesList.appendChild(newOption);\n    }\n}\n\nfunction selectExample(event) {\n    var target = event.target;\n    while (!target.classList.contains('example-option')) {\n        target = target.parentNode;\n    }\n    resetExamples();\n    target.classList.add('example-selected');\n    document.getElementById('example-confirm').disabled = false;\n}\n\nfunction resetExamples () {\n    var all = document.querySelectorAll('.example-option');\n    for (var i = 0, j = all.length; i < j; i++) {\n        all[i].classList.remove('example-selected');\n    }\n}\n\nfunction openExample (value) {\n    window.history.pushState({\n        loadStyleURL: value\n    }, null, '.?style=' + value + window.location.hash);\n    loadFromQueryString();\n}\n\nfunction loadFromQueryString () {\n    /* global query, editor */\n    query = parseQuery(window.location.search.slice(1));\n    var source = query['style'] ? query['style'] : \"data/styles/basic.yaml\";\n    loadStyle(editor,fetchHTTP(source));\n}\n\nfunction onFileSelectorChange (event) {\n    var files = event.target.files;\n    openContent(files[0]);\n}\n\nfunction openContent (content) {\n    var reader = new FileReader();\n    reader.onload = function(e) {\n        loadStyle(editor, e.target.result);\n    }\n    reader.readAsText(content);\n}\n\nfunction saveContent(){\n    if (editor) {\n        var blob = new Blob([ getContent(editor)], {type: \"text/plain;charset=utf-8\"});\n        saveAs(blob, \"style.yaml\");\n        editor.isSaved = true;\n    }\n}\n\nfunction isEditorSaved () {\n    if (editor) {\n        return editor.isSaved;\n    } else {\n        return false;\n    }\n}\n\nfunction onWindowResize( event ) {\n    reflowUI();\n    applyNewDraggableBounds(draggable[0]);\n    updateUI(editor, map);\n}\n\nfunction reflowUI() {\n    var mapEl = document.getElementById('map');\n    var contentEl = document.getElementById('content');\n    var dividerEl = document.getElementById('divider');\n    var menuEl = document.getElementById('menu-container');\n    var menuBottom = menuEl.getBoundingClientRect().bottom;\n    var positionX = dividerEl.getBoundingClientRect().left;\n\n    mapEl.style.width = positionX + \"px\";\n    contentEl.style.width = (window.innerWidth - positionX) + \"px\";\n\n    editor.setSize('100%', (window.innerHeight - menuBottom) + 'px');\n    dividerEl.style.height = (window.innerHeight - menuBottom) + 'px';\n}\n\nfunction updateUI(editor, map) {\n    map.invalidateSize(false);\n    Widgets.updateWidgets(editor);\n}\n\nfunction applyNewDraggableBounds (draggable) {\n    draggable.applyBounds(getDraggableBounds())\n}\n\nfunction getDraggableBounds () {\n    return {\n        minX: 100,\n        maxX: window.innerWidth - CM_MINIMUM_WIDTH\n    }\n}\n\nfunction takeScreenshot() {\n    if (take_screenshot == false){\n        take_screenshot = true;\n        scene.requestRedraw();\n    }\n}\n\nfunction showShield () {\n    document.getElementById('shield').style.display = 'block'\n}\n\nfunction hideShield () {\n    document.getElementById('shield').style.display = 'none'\n}\n\nfunction showUnsavedModal (confirmCallback, cancelCallback) {\n    showShield()\n    var modalEl = document.getElementById('confirm-unsaved')\n    modalEl.style.display = 'block'\n    modalEl.querySelector('#modal-confirm').addEventListener('click', handleConfirm, false)\n    modalEl.querySelector('#modal-cancel').addEventListener('click', handleCancel, false)\n\n    function handleConfirm () {\n        hideUnsavedModal()\n        confirmCallback()\n    }\n\n    function handleCancel () {\n        hideUnsavedModal()\n        cancelCallback()\n    }\n\n    function hideUnsavedModal () {\n        hideShield();\n        document.getElementById('confirm-unsaved').style.display = 'none'\n        modalEl.querySelector('#modal-confirm').removeEventListener('click', handleConfirm, false)\n        modalEl.querySelector('#modal-cancel').removeEventListener('click', handleCancel, false)\n    }\n}\n\nfunction hideMenus () {\n    var els = document.querySelectorAll('.menu-dropdown');\n    for (var i = 0, j = els.length; i < j; i++) {\n        els[i].style.display = 'none';\n    }\n}\n\nfunction loseMenuFocus () {\n    hideMenus();\n}\n\nfunction onClickOpenFile (event) {\n    if (isEditorSaved() === false) {\n        showUnsavedModal(handleContinue, handleCancel);\n    } else {\n        handleContinue();\n    }\n\n    function handleContinue () {\n        var input = document.getElementById('file-selector');\n        input.click();\n    }\n\n    function handleCancel () {\n        return;\n    }\n}\n\nfunction onClickOpenExample (event) {\n    if (isEditorSaved() === false) {\n        showUnsavedModal(handleContinue, handleCancel);\n    } else {\n        handleContinue();\n    }\n\n    function handleContinue () {\n        showExamplesModal();\n    }\n\n    function handleCancel () {\n        return;\n    }\n}\n\nfunction showExamplesModal () {\n    showShield();\n    document.getElementById('choose-example').style.display = 'block';\n}\n\nfunction hideExamplesModal () {\n    hideShield();\n    resetExamples();\n    document.getElementById('example-confirm').disabled = true;\n    document.getElementById('choose-example').style.display = 'none';\n}\n\nfunction onClickOpenExampleFromDialog () {\n    var selected = document.querySelectorAll('.example-option.example-selected')[0];\n    var value = selected.getAttribute('data-value');\n    hideExamplesModal();\n    openExample(value);\n}\n\nfunction showFileDropArea () {\n    document.getElementById('file-drop').style.display = 'block';\n}\n\nfunction hideFileDropArea () {\n    document.getElementById('file-drop').style.display = 'none';\n}\n\nfunction onDropFile (event) {\n    event.preventDefault();\n    hideFileDropArea();\n    var dataTransfer = event.dataTransfer;\n    if (dataTransfer.files.length > 0) {\n        var file = dataTransfer.files[0];\n        if (isEditorSaved() === false) {\n            showUnsavedModal(handleContinue, handleCancel);\n        } else {\n            handleContinue();\n        }\n    }\n\n    function handleContinue () {\n        openContent(file);\n    }\n\n    function handleCancel () {\n        return;\n    }\n}\n","'use strict';\n\n// Imports\nconst Utils = require('./core/common.js');\nconst Map = require('./core/map.js');\nconst Editor = require('./core/editor.js');\nconst UI = require('./core/ui.js');\nconst Widgets = require('./addons/widgets.js');\nconst SuggestedKeys = require('./addons/suggestedKeys.js');\n\n// Get query string and parse it\nconst query = Utils.parseQuery(window.location.search.slice(1));\nconst flags = Utils.parseFeatureFlags(query);\n\nif (flags['fullmenu'] === true) {\n    document.querySelector('html').classList.add('full-menu');\n}\n\nif (Utils.isMobile() === true) {\n    document.getElementById('mobile-message').style.display = 'block';\n    document.getElementById('dismiss-mobile-message').addEventListener('click', function (e) {\n        document.getElementById('mobile-message').style.display = 'none';\n        reflowUI();\n    });\n}\n\n// Initial style when it loads\nconst style = query['style'] ? query['style'] : 'data/styles/basic.yaml';\n\n// Tangram Map\nconst map = Map.init(style);\n\n// Editor\nconst editor = Editor.init(document.getElementById('editor'), style);\n\n// UI\nUI.init(editor, map);\n\n// Editor Widgets\nWidgets.loadWidgets(editor, 'data/widgets.json');\nSuggestedKeys.loadKeys(editor, 'data/keys.json');\n\n// Once everything is loaded\nsetTimeout(function () {\n    if (query['foldLevel']) {\n        Editor.unfoldAll(editor);\n        Editor.foldByLevel(editor, parseInt(query['foldLevel']));\n    }\n    if (query['lines']) {\n        Editor.selectLines(editor, query['lines']);\n    }\n\n    Widgets.createWidgets(editor);\n    //Widgets.updateWidgets(editor);\n}, 500);\n"],"sourceRoot":"/source/"}